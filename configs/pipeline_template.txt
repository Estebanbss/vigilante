# Plantilla de pipeline GStreamer (usa placeholders {CAMERA_URL} y {FILE_PATH})
# Puedes exportar GST_PIPELINE_TEMPLATE_FILE a la ruta de este archivo
# Ejemplo:
#   export GST_PIPELINE_TEMPLATE_FILE="./configs/pipeline_template.txt"
# o directamente:
#   export GST_PIPELINE_TEMPLATE='rtspsrc location={CAMERA_URL} ... filesink location="{FILE_PATH}"'

rtspsrc location={CAMERA_URL} latency=2000 protocols=tcp name=src \
  src. ! rtph264depay ! h264parse ! tee name=t_video \
  t_video. ! queue max-size-buffers=500 max-size-time=10000000000 max-size-bytes=100000000 ! mp4mux name=mux faststart=true ! filesink location="{FILE_PATH}" sync=false \
  src. ! rtppcmadepay ! alawdec ! audioconvert ! audioresample ! tee name=t_audio \
  t_audio. ! queue max-size-buffers=50 max-size-time=5000000000 ! voaacenc bitrate=64000 ! queue ! mux.audio_0 \
  t_audio. ! queue max-size-buffers=20 max-size-time=3000000000 ! lamemp3enc ! appsink name=audio_mp3_sink sync=false max-buffers=20 drop=true \
  t_video. ! queue max-size-buffers=10 max-size-time=1000000000 ! avdec_h264 ! videoconvert ! videoscale ! video/x-raw,format=GRAY8,width=320,height=180 ! appsink name=detector emit-signals=true sync=false max-buffers=1 drop=true \
  t_video. ! queue max-size-buffers=15 max-size-time=2000000000 ! avdec_h264 ! videoconvert ! videoscale ! video/x-raw,width=1280,height=720 ! videorate ! video/x-raw,framerate=15/1 ! jpegenc quality=85 ! appsink name=mjpeg_sink sync=false max-buffers=1 drop=true \
  t_video. ! queue max-size-buffers=10 max-size-time=1000000000 ! avdec_h264 ! videoconvert ! videoscale ! video/x-raw,width=640,height=360 ! videorate ! video/x-raw,framerate=8/1 ! jpegenc quality=70 ! appsink name=mjpeg_low_sink sync=false max-buffers=1 drop=true
